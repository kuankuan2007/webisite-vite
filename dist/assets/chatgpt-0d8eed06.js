import{_ as e,a as t,l as a,P as s,N as o,O as n,u as l,o as r,b as i,e as c,h as u,t as d,v as m,d as h,w as g,n as p,a2 as v,s as f,r as y,a0 as k,L as _,M as w,F as S,Q as b,j as x,a3 as R,x as j,i as E}from"./all-7fb1665d.js";import{m as O}from"./header-93f915ff.js";import{_ as T}from"./contextMenu-e95d3f2a.js";import{_ as B}from"./markdownShower-23abf85c.js";import{m as C}from"./markDownEditor-f49b7113.js";const H={class:"message"},L={class:"info"},M={key:0,class:"loading",src:"/assets/loading-422763ff.gif"},N=e({__name:"history",props:{data:{type:Object,default:{},required:!0},right:{type:Boolean,default:!1,required:!1}},emits:["recall"],setup(e,{emit:y}){const k=e;let _=t(!0),w=t();function S(e){"copy-markdown"===e?(v(k.data.message),f("复制成功")):"copy-html"===e?(v(w.value.makeHtml(k.data.message)),f("复制成功")):"delete"===e?_.value=!1:"recall"===e&&y("recall")}a("username",t,sessionStorage,"",!1),a("userrights",t,sessionStorage,"",!1);let b=s((()=>({title:"消息",menu:[{title:"复制",sub:{title:!1,menu:[{title:"MarkDown",event:"copy-markdown"},{title:"HTML",event:"copy-html"}]}},{title:"删除消息",event:"delete"}]})));return(t,a)=>o((r(),i("div",{class:p(["message-box",{right:l(k).right,normal:!l(k).right}])},[c("div",H,[c("p",L,[u(d(`${e.data.user}`)+" ",1),0===l(k).data.statue?(r(),i("img",M)):m("",!0)]),h(T,{onChoice:S,data:l(b)},{default:g((()=>[h(B,{class:p([{empty:!e.data.message},"content"]),content:e.data.message||"正在思考...",ref_key:"messageShower",ref:w,"header-level-start":2},null,8,["class","content"])])),_:1},8,["data"])])],2)),[[n,l(_)]])}},[["__scopeId","data-v-51109dd9"]]);let q=a("username",t,sessionStorage,"",!1);class D{constructor(e,t,a=0,s=void 0){this.message=t,this.user=e,this.statue=a,this.error=s}add(e){this.message+=e}}let I,P=y([new D("Sysyem","Welcome to chatgpt!",1)]);function $(e){let t=JSON.parse(e.data);void 0===t.type?P[P.length-1].add(t.text):"END"===t.type?P[P.length-1].statue=1:"ERROR"===t.type&&(P[P.length-1].statue=-1,k(`ERROR: ${t.content}`),P[P.length-1].error=t.content)}const A={class:"main"},G={class:"history-list"},J={class:"input-box"};E(e({__name:"App",setup(e){_((()=>{I=new WebSocket("wss://kuankuan.site/chatgpt"),I.onmessage=$,w((()=>{bottomAdded.value,n.value.scrollHeight-n.value.clientHeight-n.value.scrollTop<300&&setTimeout(toButton,0)}))}));let o=s((()=>R.height/4)),n=t(),u=a("username",t,sessionStorage,"",!1),d=t();function m(e){e.ctrlKey&&g()}function g(){var e;d.refresh&&d.refresh(),e=d.value,(/^\s*$/.test(e)?(f("消息为空哦"),0):0===P[P.length-1].statue?(k("上次响应还未结束，请耐心等待"),0):(P.push(new D(q.value,e,1)),P.push(new D("chatGPT","")),I.send(JSON.stringify({check:localStorage.getItem("check"),question:e})),1))&&(d.value="")}function p(e){"send"===e&&g()}return(e,t)=>(r(),i(S,null,[h(O,{title:"chatGPT问答","need-rights":!0,toLogin:!0}),c("div",A,[c("div",{class:"history-box",ref_key:"historyBox",ref:n},[c("div",G,[(r(!0),i(S,null,b(l(P),(t=>(r(),j(N,{onRecall:a=>e.recall(t.id),data:t,key:t.id,right:t.user===l(u)},null,8,["onRecall","data","right"])))),128))])],512),c("div",J,[h(C,{"place-holder":"按下Ctrl+Enter以发送",onSpicalEnter:m,"other-buttons":[{event:"send",inner:'发送<span class="demo-icon"><span>'}],headerLevelStart:2,"max-editor-height":l(o),content:l(d),"onUpdate:content":t[0]||(t[0]=e=>x(d)?d.value=e.target.value:d=e.target.value),onCustomButtomClick:p},null,8,["other-buttons","max-editor-height","content"])])])],64))}},[["__scopeId","data-v-cf45b83e"]])).mount("#app");
