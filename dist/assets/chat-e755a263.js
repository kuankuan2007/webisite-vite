import{_ as e,M as t,o as a,b as s,e as n,t as l,d as o,u as r,r as i,a as d,s as u,I as c,n as m,F as p,N as g,j as h,q as v,i as f}from"./all-b9340eea.js";import{m as y}from"./header-795b47a1.js";import{_ as b}from"./markdownShower-56d21add.js";import{m as k}from"./markDownEditor-fa06b0d9.js";const _={class:"message-box"},w={key:0,class:"message"},S={class:"info"},j={key:1,class:"recalled"},I=e({__name:"history",props:{data:{type:Object,default:{},required:!0},right:{type:Boolean,default:!1,required:!1}},setup(e){const i=e;let d=t((()=>i.data.user===i.data.message?`${i.data.user} 撤回了一条消息`:`${i.data.user} 撤回了一条 ${i.data.message} 消息`));return(t,i)=>(a(),s("div",_,[0===e.data.statue?(a(),s("div",w,[n("p",S,l(e.data.time)+" · "+l(e.data.user),1),o(b,{class:"content",content:e.data.message,"header-level-start":2},null,8,["content"])])):(a(),s("p",j,l(r(d)),1))]))}},[["__scopeId","data-v-bb760e42"]]);class O extends i{constructor(e,t,a,s,n){super({}),this.id=e,this.user=t,this.statue=a,this.message=s,this.time=n}}let x=i([]),N=d(2);const $=20;let q,C=!1,J=d(0);function R(){1===N.value&&u("没有更多啦"),N.value=2,q.send(JSON.stringify({check:localStorage.getItem("check"),type:"history",from:x.length,to:x.length+$}))}function B(e){let t=JSON.parse(e.data);if("history"===t.type){if(0==t.data.length)return void(N.value=1);N.value=0;for(let e=0;e<t.data.length;e++)x.unshift(new O(t.data[e].id,t.data[e].user,t.data[e].statue,t.data[e].message,t.data[e].time));x.length===t.data.length&&(J.value+=t.data.length)}if("message"===t.type&&(x.push(new O(t.id,t.user,t.statue,t.message,t.time)),J.value++),"recall"===t.type)for(let a=0;a<x.length;a++)if(x[a].id==t.id)return x[a].statue=1,void(x[a].message=t.user);"ERROR"===t.type&&location.reload()}const E={class:"main"},L={class:"history-box"},A={class:"history-list"},D={class:"input-box"};f(e({__name:"App",setup(e){c((()=>{C||(q=new WebSocket("wss://kuankuan.site/chat/ws"),q.onmessage=B,q.onopen=R,C=!0)}));let i=d(""),f=t((()=>0===N.value?"加载更多":1===N.value?"没有更多啦":2===N.value?"加载中":"出错啦"));function b(e){var t;"send"===e&&(t=i.value,/^\s*$/.test(t)?u("消息为空哦"):q.send(JSON.stringify({check:localStorage.getItem("check"),message:t,type:"send"})),i.value="")}return(e,t)=>(a(),s(p,null,[o(y,{title:"聊天室",toLogin:!0}),n("div",E,[n("div",L,[n("div",A,[n("button",{class:m(["get-more",{disabled:0!=r(N)}]),onClick:t[0]||(t[0]=(...e)=>r(R)&&r(R)(...e))},[n("span",null,l(r(f)),1)],2),(a(!0),s(p,null,g(r(x),(e=>(a(),v(I,{data:e,key:e.id},null,8,["data"])))),128))])]),n("div",D,[o(k,{"other-buttons":[{event:"send",inner:'发送<span class="demo-icon"><span>'}],headerLevelStart:2,content:r(i),"onUpdate:content":t[1]||(t[1]=e=>h(i)?i.value=e.target.value:i=e.target.value),onCustomButtomClick:b},null,8,["other-buttons","content"])])])],64))}},[["__scopeId","data-v-aa315bb6"]])).mount("#app");
